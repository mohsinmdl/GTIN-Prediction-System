<!doctype html>
<html>
<head>
<title> ASCE MAP</title>
 
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta charset="utf-8"> 


<body >
<style>
div#section  {
    border-style: solid;
  
}
</style>


</div>
<div id="footer">
Copyright � civildatanalytics.com
</div>

</body>


<br>
<head>


	<script type="text/javascript" src="jquery-2.0.3.min.js"></script> 
	<script src="crossfilter.js"></script>
	<script src="jquery.form.js"></script>
	
	<script type="text/javascript" src="jquery.dataTables.js"></script>	
	<script src="d3.js"></script>
	
	<script type="text/javascript" src="dc.js"></script>
	
	<link rel="stylesheet" type="text/css" href="bootstrap.css"/>
	<script type="text/javascript" src="bootstrap.min.js"></script>	
	
	
    <link rel="stylesheet" type="text/css" href="dataTables.bootstrap.css"/>
	<script type="text/javascript" src="dataTables.bootstrap.js"></script>
   <link rel="stylesheet"  href="leaflet.css" />

    <script  src="leaflet.js"> </script>


	<link rel="stylesheet" type="text/css" href="dc.css"/>
	<!-- <script src="dc.js"></script> -->
   
    <link  rel="stylesheet" href="style.css"  type="text/css" media="all"/> 
 
   <script type="text/javascript" src="http://www.kunalbabre.com/projects/table2CSV.js" > </script> 
   <script type="text/javascript" src="us-states.js"></script>
 
 </head>
 
<div class="container-fluid">
     <style>  <!-- This is where we define the style for the county legends , also define the map dimensions -->
div#section2  {
    border-style: solid;
	border-width: 2px;
  
               }

		#map {
			width: 80%;
			height: 400px;
		}

		.info {
			padding: 6px 8px;
			font: 14px/16px Arial, Helvetica, sans-serif;
			background: white;
			background: rgba(255,255,255,0.8);
			box-shadow: 0 0 15px rgba(0,0,0,0.2);
			border-radius: 5px;
		}
		.info h4 {
			margin: 0 0 5px;
			color: #777;
		}

		.legend {
			text-align: left;
			line-height: 18px;
			color: #555;
		}
		.legend i {
			width: 18px;
			height: 18px;
			float: left;
			margin-right: 8px;
			opacity: 0.7;
		}


	div.tooltip {	
    position: absolute;			
    text-align: center;			
    width: 10%;					
    height: 105px;					
    padding: 2px;				
    font: 12px sans-serif;		
    background: lightsteelblue;	
    border: 0px;		
    border-radius: 8px;			
   		
		
		
}

</style>
 <!--pointer-events: none; ;-->
 
 
    <title>CIVIL DATA ANALYTICS </title>


  </head>

  <body role="document">

    <!-- Fixed navbar -->
    <nav class="navbar navbar-inverse navbar-fixed-top">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="http://www.civildatanalytics.com/" target="_blank" >CIVIL DATA ANALYTICS   
		  
		  </a>
        </div>
        <div id="navbar" class="navbar-collapse collapse">
          <ul class="nav navbar-nav">
            <li class="active"><a href="http://www.civildatanalytics.com/events.html"  target="_blank"> EVENTS</a></li>
			
            <li><a href="http://www.civildatanalytics.com/lead-members.html" target="_blank">ABOUT</a></li>
			
			
            <li><a href="http://www.civildatanalytics.com/contact-us.html#contact" target="_blank">CONTACT US</a></li>
           
		   <li class="dropdown">
              <a href="http://www.civildatanalytics.com/current-projects.html" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">PROJECTS <span class="caret"></span></a>
              <ul class="dropdown-menu">
                <li><a href="http://www.civildatanalytics.com/innovative-infrastructure-financing.html" target="_blank">Innovative Infrastructure Financing </a></li>
                <li><a href="http://www.civildatanalytics.com/advanced-data-analysis.html" target="_blank">Advanced Data Analysis</a></li>
                <li><a href="http://www.civildatanalytics.com/uav-bridge-inspection.html" target="_blank">UAV Bridge Inspection</a></li>
                <li role="separator" class="divider"></li>
                <li class="dropdown-header">Current PPP Research</li>
                <li><a href="http://www.civildatanalytics.com/global-view-of-projects-with-increased-private-participation.htmlPrivate" target="_blank">Sector Participation in Public Infrastructure Development: The Global View</a></li>
                <li><a href="http://www.civildatanalytics.com/probability-of-a-p3-project-status-study.html"target="_blank" >Probability of a P3 project status </a></li>
              </ul>
            </li>
          </ul>
        </div><!--/.nav-collapse -->
      </div>
    </nav>

    <div class="container theme-showcase" role="main">

      <!-- Main jumbotron for a primary marketing message or call to action -->
      <div class="jumbotron">
        <h2>ASCE INFRASTRUCTURE MAP </h2>
        <p> Using information from the ASCE Infrastructure report card for states, CDA has developed an interactive map which shows the current conditions of the nation's ageing infrastructure. Hover over each state on the map to get a snapshot of its infrastructure needs.
		The table at the bottom of the screen is updated each time parts of the bar graph and pie charts are highlighted. States have been linked to their respective report cards from ASCE. </p>
		<P>The aim is to let the general public understand better the conditions of infrastructure in their states.</P>
      </div>

</h1> </center> 
</div>


<div class="row" >
<h1 align="center">
	   <button type="button" class="btn btn-lg btn-primary" id="btnReset1" onclick="dc.filterAll(); dc.renderAll();"> ASCE INFRASTUCTURE MAP </button>

&nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; 
 <button type="button" class="btn btn-lg btn-primary" id="btnExport" onclick="fnExcelReport();"> EXPORT (.xls)</button>
   
   &nbsp;&nbsp; <input value="EXPORT (.csv)" type="button" class="btn btn-lg btn-primary" onclick="$('#dc-data-table').table2CSV({header:['State','GPA','Structurally Deficient Bridges (%)','Drinking Water Needs in 20 years ($billions)',
 'Roads in Poor Conditions (%)','Cost Incurred Using Roads per Motorist ($)', ' Unmet needs for Public Parks ($millions)', 'Waste-water needs in 20 years ($billions)',]})">  
</h1> 
 </div>  


<!-- <
<center><h1 align="center">
<button id="btnReset1" onclick="javascript:dc.filterAll(); dc.renderAll();"> ASCE INFRASTUCTURE MAP </button>
</h1> </center> 
-->

<div class="row" >
<div class="col-md-6">
            <div id="map"  style="width:100%; height:600px"> <br>
			</div>
		</div>
		
		 <!-- <center> -->
        <!-- <div class="col-md-6 col-md-offset-1"> -->
		<div class="col-md-6 ">
    <table id="dc-data-table" class="list table table-striped table-bordered">
    <thead>
        <tr class='header' center style="background-color: Cornsilk ;">
            <th>  State</th>
			<th> GPA</th>
			<th> Structurally Deficient Bridges (%)</th>
			<th> Drinking Water Needs in 20 years ($billions)</th>
			<th> Cost Incurred Using Roads per Motorist($)</th>
			<th> Roads in Poor Conditions(%) </th>
			<th> Unmet needs for Public Parks ($millions)</th>
			<th> Waste-water needs in 20 years ($billions) </th>
         </tr>
    </thead>
</table>
</div>
		
		
</div>



<div class="row" >
<div class="col-md-3">
<div id="wneeds" class="dc-chart"> <!-- rowchart4-->	
<div class="title"><b>Drinking Water Needs in 20 years ($billions)   <button id="btnReset4" onclick="WaterNeeds.filterAll(); dc.redrawAll();"> RESET </button></b></div>
<div class="clearfix"></div>
		   </div>		   
<div id="schoolneeds" class="dc-chart">
<div class="title"><b> Unmet needs for Public Schools ($millions) <button id="btnReset3" onclick="SchoolNeeds.filterAll(); dc.redrawAll();"> RESET </button></b></div>
<div class="clearfix"></div>    
			</div>		   
   
 </div>

<div class="col-md-3">
<div id="proadcost" class="dc-chart">	  <!-- rowchart6-->
		<div class="title"><b> Roads in Poor Conditions (%) <br/> <button id="btnReset2" onclick="PRoadCost.filterAll(); dc.redrawAll();"> RESET </button></b></div>
	        <div class="clearfix"></div>
			</div>
<div id="roadcost" class="dc-chart">	  <!-- rowchart6-->
		<div class="title"><b> Cost Incurred Using Roads per Motorist ($)  <button id="btnReset2" onclick="RoadCost.filterAll(); dc.redrawAll();"> RESET </button></b></div>
	        <div class="clearfix"></div>
			</div>			
		
</div>	

<div class="col-md-6 " >
	<div id="gpa"  class="dc-chart" > 
<div class="title"><b>Infrastructure Grade <button id="btnReset3" onclick="GPA.filterAll(); dc.redrawAll();"> RESET </button></b></div>
	        
<div class="clearfix"></div>
</div>

<div class="row" >
<div class="col-md-3">
<div id="pct_Bridge" class="dc-chart">
<div class="title"><b>Structurally Deficient Bridges (%) <button id="btnReset3" onclick="PCT_Bridge.filterAll(); dc.redrawAll();"> RESET </button></b></div>
<div class="clearfix"></div>
</div>	
</div>
<div class="col-md-3 col-md-offset-3">
<div id="waste" class="dc-chart">
<div class="title"><b>Wastewater Needs ($ billions)  <button id="btnReset4" onclick="Waste .filterAll(); dc.redrawAll();"> RESET </button></b></div>
<div class="clearfix"></div> 
		   </div>	
</div>
</div>	
</div>	

</div>
		











  <div class="row" >
 
</div>
<body>
<div id="footer">
Copyright � civildatanalytics.com
</div>

</body>
 </div>

	<script type="text/javascript">
	

		var GPA = dc.rowChart("#gpa");
	    
		var PCT_Bridge = dc.pieChart("#pct_Bridge");
	   var SchoolNeeds = dc.pieChart("#schoolneeds");
		
		var RoadCost = dc.pieChart("#roadcost");
		var PRoadCost= dc.pieChart("#proadcost");
	    
	
		var Wneeds = dc.pieChart("#wneeds");
		
		var Waste = dc.pieChart("#waste");
		
		
		//var DataTable = dc.dataTable("#dc-data-table");
		

	d3.csv("asce_states1.csv", function(fullresponse) {

            fullresponse.forEach(function (e) {
	
				e.state=e.State;
			
                e.PercentSD = +e.Percent_SD;
				e.water_needs=+e.dwn;
				e.Road_Cost=+e.Roads_per_year_per_motorist;
				e.parkneeds=+e.Public_Parks_unfunded; 
				e.GPA_N=+e.GPA_N;
				e.wastew=+e.Wastewater_needs;
				
				 //// charts
				e.GPA = e.GPA;
				e.HZD=e.hazdam_class;   //haz dams
				e.DW1 = e.dwneeds;   //dringking water needs
				e.RC=e.roadcost_class;   //road cost per motorist
				e.PPR=e.pct_road;   //percent poor roads 
				e.SN=e.SchNEED;   //school needs 
				e.HZWS=e.hazsite_class;   //hazard waist sites 
				e.PSDB=e.pct_Sdclass;   //percent structurally deficent bridges 
				e.wasteww=e.wastewater_class; //wastewater needs class
			 
            });	
		   
			  	var map = L.map('map').setView([37.8, -96], 4);

		L.tileLayer('https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token=pk.eyJ1IjoibWFwYm94IiwiYSI6IjZjNmRjNzk3ZmE2MTcwOTEwMGY0MzU3YjUzOWFmNWZhIn0.Y8bhBaUMqFiPrDRW9hieoQ', {
			maxZoom: 16,
			minZoom:3,
			attribution: 'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, ' +
				'<a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, ' +
				'Imagery � <a href="http://mapbox.com">Mapbox</a>',
			id: 'mapbox.light'
		}).addTo(map);


		// control that shows state info on hover
		var info = L.control();

		info.onAdd = function (map) {
			this._div = L.DomUtil.create('div', 'info');
			this.update();
			return this._div;
		};
         	

			   info.update = function (d) {
			   
			   this._div.innerHTML = '<h4>Infrastructure Snapshot</h4>' +  (d?
				'<b><u><font size="4" color="blue">' + d.name + '</u></b><br /> <strong> <font size="3" color="black"> Structurally Deficient Bridges =</strong><font size="3" color="red">' + d.Percent_SD + '<font size="3" color="black">%'+'</b><br /> <strong>Roads in Poor Conditions =</strong><font size="3" color="red"> '+d.Percet_roads_poor_cond +'<font size="3" color="black">%'+ ' </b><br /><strong> Cost incurred using roads per motorist ($) =</strong><font size="3" color="red"> '+ d.Roads_per_year_per_motorist+'<font size="3" color="black"></b><br /><strong> Waste Water Funding needs($ billions)  =</strong><font size="3" color="red">'  + d.Wastewater_needs +'<font size="3" color="black"></b><br /><strong> Public Parks Funding needs($ millions) =</strong><font size="3" color="red">'+ d.Public_Parks_unfunded +'<font size="3" color="black"><br />'
				: 'Hover over a state');
		}; 

		info.addTo(map); 

		// get color depending on population density value
		function getColor(d) {
			return d == 6 ? '#4d9221' :
			       d == 5  ? '#b8e186' :
			       d == 4  ? '#74a9cf' :
			       d == 3  ? '#d73027' :
			       d == 2   ? '#fc9272' :
			  //     d == 1   ? '#b10026' :
			                  '#737373';
		} 

		function style(feature) {
			return {
				weight: 2,
				opacity: 1,
				color: 'white',
				dashArray: '3',
				fillOpacity: 0.7,
			fillColor: getColor(feature.properties.GPA_N)
			   // fillColor: getColor(mat)
			};
		}

		function highlightFeature(e) {
			var layer = e.target;

			layer.setStyle({
				weight: 5,
				color: '#666',
				dashArray: '',
				fillOpacity: 0.7
			});

			if (!L.Browser.ie && !L.Browser.opera) {
				layer.bringToFront();
			}

			
			info.update(layer.feature.properties);
		}

		var geojson;

		function resetHighlight(e) {
			geojson.resetStyle(e.target);
			info.update();
		}

		
		function open_url(e) {
			window.open(e.target.feature.properties.url);
		}
		
		
		
		function zoomToFeature(e) {
			map.fitBounds(e.target.getBounds());
		}

		function onEachFeature(feature, layer) {
			layer.on({
				mouseover: highlightFeature,
				mouseout: resetHighlight,
				//click: zoomToFeature
				click: open_url
			});
		}

		
		
		geojson = L.geoJson(statesData, {
			style: style,
			onEachFeature: onEachFeature
		}).addTo(map);

		
		map.attributionControl.addAttribution('Infrastructure Grades; <a href="http://www.infrastructurereportcard.org/">ASCE</a>');

	  var legend = L.control({position: 'bottomright'});

		legend.onAdd = function (map) {

			    var div = L.DomUtil.create('div', 'info legend'),
        lower = ['N/A','D','D+','C-','C','C+'],
        upper = ['','',' ','','',''],
        labels = [];

    // loop through our density intervals and generate a label with a colored square for each interval
    for (var i = 0; i < lower.length; i++) {
        div.innerHTML +=
            '<i style="background:' + getColor(i + 1) + '"></i> ' +
            lower[i]  + upper[i]+'<br>';
   }
    return div;
};



		legend.addTo(map);
		
		var tabledata = crossfilter(fullresponse);
			
            table_dimension = tabledata.dimension(
                       function (d) { return d.state; });
            g = table_dimension.group(function (v) { return v; });
			
			GPA_dimension = tabledata.dimension(
                       function (d) { return d.GPA; });
            g1 = GPA_dimension.group(function (v) { return v; });
			
			PSDB_dimension = tabledata.dimension(
                       function (d) { return d.PSDB; });
            g2 = PSDB_dimension.group(function (v) { return v; });
			
			DW1_dimension = tabledata.dimension(
                       function (d) { return d.DW1; });
            g3 = DW1_dimension.group(function (v) { return v; });
			
		    RC_dimension = tabledata.dimension(
                       function (d) { return d.RC; });
            g4 = RC_dimension.group(function (v) { return v; });
		
		    SN_dimension = tabledata.dimension(
                       function (d) { return d.SN; });
            g5 = SN_dimension.group(function (v) { return v; });
		
		    PPR_dimension = tabledata.dimension(
                       function (d) { return d.PPR; });
            g6 = PPR_dimension.group(function (v) { return v; });
				
			wasteww_dimension = tabledata.dimension(
                       function (d) { return d.wasteww; });
            g7 = wasteww_dimension.group(function (v) { return v; });	
	
				
				GPA.dimension(GPA_dimension)
						.group(g1)
						.width(600)
						.height(250)
						.elasticX(true)
						.title(function(d){return d.value;})
						.renderTitle(true)
						.renderLabel(true)
						.ordinalColors(["#4d9221","#b8e186","#74a9cf","#d73027","#fc9272","#737373"])
						.label(function (d){
                         return d.key.split(".")[1];
                         })
						.xAxis().ticks(5);
			
			   	PCT_Bridge.dimension(PSDB_dimension)
						.group(g2)
						.width(300)
						.height(200)
                        .innerRadius(70)
						.renderLabel(false)
						.ordinalColors(["#fdd0a2","#fd8d3c","#d94801"]) 
						.legend(dc.legend().x(100).y(70).itemHeight(13).gap(5));
						
						
                   Wneeds.dimension(DW1_dimension)  ///water needs
						.group(g3)
						.width(300)
						.height(200)
                        .innerRadius(70)
						.renderLabel(false)
						.ordinalColors(["#fdd0a2","#fd8d3c","#d94801"])
						.legend(dc.legend().x(100).y(70).itemHeight(13).gap(5));
						
	
			   	RoadCost.dimension(RC_dimension)
						.group(g4)
						.width(300)
						.height(200).
						innerRadius(70)
						.renderLabel(false)
						.legend(dc.legend().x(100).y(70).itemHeight(13).gap(5))
						.ordinalColors(["#d94801","#fd8d3c","#fdd0a2"]);
						
				PRoadCost.dimension(PPR_dimension)
						.group(g6)
						.width(300)
						.height(200).
						innerRadius(70)
						.renderLabel(false)
						.legend(dc.legend().x(110).y(65).itemHeight(13).gap(5))
						.ordinalColors(["#a63603","#fdd0a2","#fdbe85","#fd8d3c","#e6550d"]); 

						
			   
			   SchoolNeeds.dimension(SN_dimension)
						.group(g5)
						.width(300)
						.height(200)
						.innerRadius(70)
						.renderLabel(false)
						.legend(dc.legend().x(110).y(70).itemHeight(13).gap(5))
						.ordinalColors(["#a63603","#fdae6b","#f16913","#d9d9d9"]);
						
						
				Waste.dimension(wasteww_dimension)
						.group(g7)
						.width(300)
						.height(200)
						.innerRadius(70)
						.renderLabel(false)
						.legend(dc.legend().x(110).y(70).itemHeight(13).gap(5))
						.ordinalColors(["#fdae6b","#f16913","#a63603","#d9d9d9"]);		
					
		var dataTableOptions = {
                "lengthMenu": [[10], [25]],
                "retrieve": true,
                columnDefs: [
                    {
                        "orderable": false,
                        targets: 0,
                        data: function (d) { return d.state; }
                    },
                    {
                        "orderable": false,
                        targets: 1,
                        data: function (d) { return d.GPA1; }
                    } ,
                    {
                        "orderable": false,
                        targets: 2,
                        data: function (d) { return d.PercentSD ; }
                    },
                    {
                        "orderable": false,
                        targets: 3,
                        data: function (d) { return d.water_needs; }
                    },
                    {
                        "orderable": false,
                        targets: 4,
                        data: function (d) { return d.Road_Cost; }
                    },
					{
                        "orderable": false,
                        targets: 5,
                        data: function (d) { return d.Percet_roads_poor_cond; }
                    },
					{
                        "orderable": false,
                        targets: 6,
                        data: function (d) { return d.parkneeds; }
                    },
					{
                        "orderable": false,
                        targets: 7,
                        data: function (d) { return d.wastew; }
                    }
                ]
            };

            var datatable = $('#dc-data-table').dataTable(dataTableOptions);

            function RefreshTable() {
                dc.events.trigger(function () {
                    datatable.api()
                      .clear()
                      .rows.add(table_dimension.top(Infinity))
                      .draw();
                });
            }

            for (var i = 0; i < dc.chartRegistry.list().length; i++) {
                var chartI = dc.chartRegistry.list()[i];
                chartI.on("filtered", RefreshTable);
            }

            //Jquery DT

            window.filter = function (filters) {
                filters.forEach(function (d, i) { charts[i].filter(d); });
                renderAll();
            };

            window.reset = function (i) {
                charts[i].filter(null);
                renderAll();
            };

			
			
            RefreshTable();
            dc.renderAll();
	 

	
		


		});
		
	function print_filter(filter){
	var f=eval(filter);
	if (typeof(f.length) != "undefined") {}else{}
	if (typeof(f.top) != "undefined") {f=f.top(Infinity);}else{}
	if (typeof(f.dimension) != "undefined") {f=f.dimension(function(d) { return "";}).top(Infinity);}else{}
	console.log(filter+"("+f.length+") = "+JSON.stringify(f).replace("[","[\n\t").replace(/}\,/g,"},\n\t").replace("]","\n]"));
	}
	
					
           // function charts(data) {
		//	var ndx = crossfilter(data);
			
			/*function charts(matija) {
			var ndx = crossfilter(matija);
		
						
							
						
		DataTable.dimension(dim)
		// data table does not use crossfilter group but rather a closure
		// as a grouping function
	    .group(function(d) {
			return "ASCE Infrastructure";
		})
		// (optional) max number of records to be shown, :default = 25
		//.size(16034)
		.size(52)
		// dynamic columns creation using an array of closures
		.columns([
		    function(d) { return d.state; },
			function(d) { return d.GPA1; },
			function(d) { return d.PercentSD; },
			function(d) { return d.water_needs; },
			function(d) {return d.Percet_roads_poor_cond;},
			function(d) { return d.Road_Cost; },
			function(d) { return d.parkneeds; },
			function(d) { return d.Wastewater_needs; },
			
			
		])
		 
					//dc.renderAll();
			
			}
			
		*/
	
		/////////////////////////////////////
		/////////////////////////////////////
		////// EXCEL EXPORT FUNCTION  ///////
		
		     function fnExcelReport()
    {
    var tab_text="<table border='2px'><tr bgcolor='#87AFC6'>";
	//var tab_text="<table border='2px'><tr bgcolor='green'>";
    var textRange; var j=0;
    tab = document.getElementById('dc-data-table'); // id of table

    for(j = 0 ; j < tab.rows.length ; j++) 
    {     
        tab_text=tab_text+tab.rows[j].innerHTML+"</tr>";
        //tab_text=tab_text+"</tr>";
    }

    tab_text=tab_text+"</table>";
    tab_text= tab_text.replace(/<A[^>]*>|<\/A>/g, "");//remove if u want links in your table
    tab_text= tab_text.replace(/<img[^>]*>/gi,""); // remove if u want images in your table
    tab_text= tab_text.replace(/<input[^>]*>|<\/input>/gi, ""); // reomves input params

    var ua = window.navigator.userAgent;
    var msie = ua.indexOf("MSIE "); 

    if (msie > 0 || !!navigator.userAgent.match(/Trident.*rv\:11\./))      // If Internet Explorer
    {
        txtArea1.document.open("txt/html","replace");
        txtArea1.document.write(tab_text);
        txtArea1.document.close();
        txtArea1.focus(); 
        sa=txtArea1.document.execCommand("SaveAs",true,"Say Thanks to Sumit.xls");
    }  
         else                 //other browser not tested on IE 11
            sa = window.open('data:application/vnd.ms-excel,' + encodeURIComponent(tab_text));  

        return (sa);
    }
		

		</script>
		
		</html>